{
  "permissions": {
    "allow": [
      "Bash(ls:*)",
      "Bash(cat:*)",
      "Bash(find:*)",
      "Read",
      "Grep",
      "Glob",
      "WebSearch",
      "WebFetch(domain:kilosort.readthedocs.io)",
      "WebFetch(domain:github.com)",
      "Bash(python:*)",
      "Bash(where:*)",
      "Bash(C:/ProgramData/anaconda3/python.exe:*)",
      "Bash(nvidia-smi:*)",
      "Bash(C:/ProgramData/anaconda3/Scripts/conda.exe env list:*)",
      "Bash(C:/Users/wakel/anaconda3/envs/neoeeg/python.exe:*)",
      "Bash(C:/Users/wakel/anaconda3/envs/neuropixels/python.exe:*)",
      "Bash(dir:*)",
      "Bash(python3:*)",
      "Bash(C:Userswakelanaconda3python.exe -c \"import sys; print\\(sys.version\\)\")",
      "Bash(\"C:/Users/wakel/anaconda3/python.exe\" -c \"import sys; print\\(sys.version\\)\")",
      "Bash(PY=\"C:/Users/wakel/anaconda3/python.exe\")",
      "Bash(\"$PY\" -m py_compile main_gui.py)",
      "Bash(\"$PY\" -m py_compile project_state.py)",
      "Bash(\"$PY\" -m py_compile font_manager.py)",
      "Bash(\"$PY\" -m py_compile step_load.py)",
      "Bash(\"$PY\" -m py_compile step_lfp.py)",
      "Bash(\"$PY\" -m py_compile step_spike_sort.py)",
      "Bash(\"$PY\" -m py_compile step_phase.py)",
      "Bash(\"$PY\" -m py_compile lfp_pipeline.py)",
      "Bash(\"$PY\" -c \"\nimport sys, os\nsys.path.insert\\(0, ''.''\\)\n\n# Check non-GUI imports\nprint\\(''--- Checking project_state ---''\\)\nfrom project_state import ProjectState, STEP_NAMES\nprint\\(f''  OK: STEP_NAMES = {STEP_NAMES}''\\)\n\nprint\\(''--- Checking font_manager ---''\\)\nfrom font_manager import apply_plot_font_size\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking LfpConfig from step_lfp ---''\\)\nfrom step_lfp import LfpConfig, BandEditorFrame\ncfg = LfpConfig\\(\\)\nprint\\(f''  OK: filter={cfg.filter_lowcut}-{cfg.filter_highcut}Hz, bands={list\\(cfg.bands.keys\\(\\)\\)}''\\)\n\nprint\\(''--- Checking lfp_pipeline import ---''\\)\nfrom lfp_pipeline import run_lfp_pipeline\nprint\\(''  OK: run_lfp_pipeline imported''\\)\n\nprint\\(''--- Checking spike_sorting imports ---''\\)\nfrom spike_sorting import SortingConfig, ChannelSortResult, SpikeUnit\ncfg2 = SortingConfig\\(\\)\nprint\\(f''  OK: filter={cfg2.filter_low}-{cfg2.filter_high}Hz''\\)\n\nprint\\(''--- Checking phase_locking imports ---''\\)\nfrom phase_locking import analyze_spike_lfp_coupling, apply_fdr_to_phase_results\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking phase_plotting_v6 import ---''\\)\nfrom phase_plotting_v6 import plot_phase_grand_summary\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking spike_processing import ---''\\)\nfrom spike_processing import load_spike_data, UnitInfo\nprint\\(''  OK''\\)\n\nprint\\(\\)\nprint\\(''=== All import checks passed ===''\\)\n\")",
      "Bash(\"C:/Users/wakel/anaconda3/python.exe\" -c \"import numpy; print\\(numpy.__version__\\)\")",
      "Bash(\"C:/Users/wakel/anaconda3/python.exe\" -c \"\nimport numpy as np\nprint\\(''numpy version:'', np.__version__\\)\nprint\\(''hasattr ptp:'', hasattr\\(np.ndarray, ''ptp''\\)\\)\ntry:\n    a = np.array\\([1,2,3]\\)\n    print\\(''ptp works:'', a.ptp\\(\\)\\)\nexcept Exception as e:\n    print\\(''ptp error:'', e\\)\ntry:\n    print\\(''np.ptp exists:'', hasattr\\(np, ''ptp''\\)\\)\nexcept:\n    pass\n\")",
      "Bash(\"$PY\" -c \"\nimport sys, os\nsys.path.insert\\(0, ''.''\\)\n\nprint\\(''--- Checking project_state ---''\\)\nfrom project_state import ProjectState, STEP_NAMES\nprint\\(f''  OK: STEP_NAMES = {STEP_NAMES}''\\)\n\nprint\\(''--- Checking font_manager ---''\\)\nfrom font_manager import apply_plot_font_size\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking LfpConfig from step_lfp ---''\\)\nfrom step_lfp import LfpConfig, BandEditorFrame\ncfg = LfpConfig\\(\\)\nprint\\(f''  OK: filter={cfg.filter_lowcut}-{cfg.filter_highcut}Hz, bands={list\\(cfg.bands.keys\\(\\)\\)}''\\)\n\nprint\\(''--- Checking lfp_pipeline import ---''\\)\nfrom lfp_pipeline import run_lfp_pipeline\nprint\\(''  OK: run_lfp_pipeline imported''\\)\n\nprint\\(''--- Checking spike_sorting imports ---''\\)\nfrom spike_sorting import SortingConfig, ChannelSortResult, SpikeUnit\ncfg2 = SortingConfig\\(\\)\nprint\\(f''  OK: filter={cfg2.filter_low}-{cfg2.filter_high}Hz''\\)\n\nprint\\(''--- Checking phase_locking imports ---''\\)\nfrom phase_locking import analyze_spike_lfp_coupling, apply_fdr_to_phase_results\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking phase_plotting_v6 import ---''\\)\nfrom phase_plotting_v6 import plot_phase_grand_summary\nprint\\(''  OK''\\)\n\nprint\\(''--- Checking spike_processing import ---''\\)\nfrom spike_processing import load_spike_data, UnitInfo\nprint\\(''  OK''\\)\n\nprint\\(\\)\nprint\\(''=== All import checks passed ===''\\)\n\")",
      "Bash(perl:*)",
      "Bash(\"$PY\" -c \"\nimport sys, os\nsys.path.insert\\(0, ''.''\\)\n\n# tkinterのrootを作ってパネル生成テスト\nimport tkinter as tk\nfrom tkinter import ttk\n\nroot = tk.Tk\\(\\)\nroot.withdraw\\(\\)  # ウィンドウ非表示\n\n# MainGUIの代わりのモック\nclass MockApp:\n    class MockState:\n        plx_file = ''''\n        output_dir = ''''\n        lfp_config = {}\n        spike_config = {}\n        phase_config = {}\n        font_size_gui = 9\n        font_size_plot = 8\n        plot_font_scale = 1.0\n        step_status = {''load'':''pending'',''lfp'':''pending'',''spike_sort'':''pending'',''phase'':''pending''}\n        def is_step_completed\\(self, s\\): return False\n        basename = ''test''\n    state = MockState\\(\\)\n    root = root\n    plx_data = None\n    lfp_results = None\n    spike_results = None\n    phase_results = None\n    def set_status\\(self, m\\): pass\n    def complete_step\\(self, s\\): pass\n    def reset_downstream\\(self, s\\): return True\n\napp = MockApp\\(\\)\nframe = ttk.Frame\\(root\\)\n\nprint\\(''--- Testing step_load.Panel ---''\\)\ntry:\n    from step_load import Panel as LoadPanel\n    p = LoadPanel\\(frame, app\\)\n    print\\(''  OK''\\)\nexcept Exception as e:\n    print\\(f''  ERROR: {e}''\\)\n\nprint\\(''--- Testing step_lfp.Panel ---''\\)\ntry:\n    from step_lfp import Panel as LfpPanel\n    p = LfpPanel\\(frame, app\\)\n    print\\(''  OK''\\)\nexcept Exception as e:\n    print\\(f''  ERROR: {e}''\\)\n\nprint\\(''--- Testing step_spike_sort.Panel ---''\\)\ntry:\n    from step_spike_sort import Panel as SpikePanel\n    p = SpikePanel\\(frame, app\\)\n    print\\(''  OK''\\)\nexcept Exception as e:\n    print\\(f''  ERROR: {e}''\\)\n\nprint\\(''--- Testing step_phase.Panel ---''\\)\ntry:\n    from step_phase import Panel as PhasePanel\n    p = PhasePanel\\(frame, app\\)\n    print\\(''  OK''\\)\nexcept Exception as e:\n    print\\(f''  ERROR: {e}''\\)\n\nroot.destroy\\(\\)\nprint\\(\\)\nprint\\(''=== All panel instantiation tests passed ===''\\)\n\")",
      "Bash(\"$PY\" -c \"\nimport sys, os\nsys.path.insert\\(0, ''.''\\)\nimport tkinter as tk\nfrom tkinter import ttk\n\nroot = tk.Tk\\(\\)\nroot.withdraw\\(\\)\n\nclass MockApp:\n    class MockState:\n        plx_file = r''\\\\\\\\test\\\\path\\\\data.plx''\n        output_dir = r''\\\\\\\\test\\\\path\\\\output''\n        lfp_config = {\n            ''filter_enabled'': True, ''filter_type'': ''fir'',\n            ''filter_lowcut'': 0.1, ''filter_highcut'': 100.0,\n            ''bands'': {''delta'': [1,4], ''theta'': [4,8]},\n        }\n        spike_config = {\n            ''filter_low'': ''300'', ''threshold_std'': ''4.0'',\n            ''_method'': ''GMM \\(内蔵\\)'',\n        }\n        phase_config = {\n            ''spike_source'': ''sorted'',\n            ''spike_quality_filter'': ''sorted_only'',\n            ''min_spikes'': ''50'',\n            ''condition_analysis'': True,\n        }\n        font_size_gui = 9\n        font_size_plot = 8\n        plot_font_scale = 1.0\n        step_status = {''load'':''pending'',''lfp'':''pending'',''spike_sort'':''pending'',''phase'':''pending''}\n        def is_step_completed\\(self, s\\): return False\n        basename = ''test''\n    state = MockState\\(\\)\n    root = root\n    plx_data = None\n    lfp_results = None\n    spike_results = None\n    phase_results = None\n    def set_status\\(self, m\\): pass\n    def complete_step\\(self, s\\): pass\n    def reset_downstream\\(self, s\\): return True\n\napp = MockApp\\(\\)\nframe = ttk.Frame\\(root\\)\n\n# step_load\nprint\\(''--- step_load ---''\\)\nfrom step_load import Panel as P0\np0 = P0\\(frame, app\\)\np0.on_show\\(\\)\ncfg0 = p0.get_config\\(\\)\nprint\\(f''  on_show OK, config: plx={cfg0[\"\"plx_file\"\"][:20]}..., out={cfg0[\"\"output_dir\"\"][:20]}...''\\)\n\n# step_lfp\nprint\\(''--- step_lfp ---''\\)\nfrom step_lfp import Panel as P1\np1 = P1\\(frame, app\\)\np1.on_show\\(\\)\ncfg1 = p1.get_config\\(\\)\nprint\\(f''  on_show OK, filter_type={cfg1.get\\(\"\"filter_type\"\"\\)}, bands={list\\(cfg1.get\\(\"\"bands\"\",{}\\).keys\\(\\)\\)}''\\)\n\n# step_spike_sort\nprint\\(''--- step_spike_sort ---''\\)\nfrom step_spike_sort import Panel as P2\np2 = P2\\(frame, app\\)\np2.on_show\\(\\)\ncfg2 = p2.get_config\\(\\)\nprint\\(f''  on_show OK, method={cfg2.get\\(\"\"_method\"\"\\)}, threshold={cfg2.get\\(\"\"threshold_std\"\"\\)}''\\)\n\n# step_phase\nprint\\(''--- step_phase ---''\\)\nfrom step_phase import Panel as P3\np3 = P3\\(frame, app\\)\np3.on_show\\(\\)\ncfg3 = p3.get_config\\(\\)\nprint\\(f''  on_show OK, source={cfg3.get\\(\"\"spike_source\"\"\\)}, min_spikes={cfg3.get\\(\"\"min_spikes\"\"\\)}''\\)\n\n# on_hide テスト\nprint\\(''--- on_hide ---''\\)\np0.on_hide\\(\\); print\\(''  step_load OK''\\)\np1.on_hide\\(\\); print\\(''  step_lfp OK''\\)\np2.on_hide\\(\\); print\\(''  step_spike_sort OK''\\)\np3.on_hide\\(\\); print\\(''  step_phase OK''\\)\n\nroot.destroy\\(\\)\nprint\\(\\)\nprint\\(''=== All lifecycle tests passed ===''\\)\n\")"
    ]
  }
}
